<div class="machines-list-container">
  <div class="header-actions">
    <h2>Painel de Controle de M√°quinas</h2>
    <button class="btn-create" (click)="toggleAddState()">
      {{ isAddingNew ? 'Esconder Formul√°rio' : '+ Nova M√°quina' }}
    </button>
  </div>

  
  <div *ngIf="isAddingNew" class="add-form-container">
    <input [(ngModel)]="newMachine.name" placeholder="Nome" class="form-input">
    <input type="number" min="1" [(ngModel)]="newMachine.cpu" placeholder="CPU (%)" class="form-input small">
    <input type="number" min="1" [(ngModel)]="newMachine.memory" placeholder="Mem√≥ria (MB)" class="form-input small">
    <input type="number" min="1" [(ngModel)]="newMachine.disk" placeholder="Disco (GB)" class="form-input small">
    
    <button (click)="onSaveNewMachine()" class="btn-save-form">Incluir</button>
  </div>

  <table *ngIf="machines$ | async as machines">
    <thead>
      <tr>
        <th>Nome</th>
        <th>CPU</th>
        <th>Mem√≥ria (Mb)</th>
        <th>Disco (GB)</th>
        <th>Status Atual</th>
        <th>Hardware</th> <!-- Coluna para Editar/Excluir -->
        <th>Opera√ß√£o</th> <!-- Coluna para Start/Stop/Suspend -->
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let machine of machines">
        <!-- Nome -->
        <td>
          <input *ngIf="editState[machine.id]" [(ngModel)]="machine.name" [name]="'n-'+machine.id" class="edit-input">
          <span *ngIf="!editState[machine.id]">{{ machine.name }}</span>
        </td>

        <!-- Recursos (Edit√°veis) -->
        <td>
          <input *ngIf="editState[machine.id]" type="number" min="1" [(ngModel)]="machine.cpu" [name]="'c-'+machine.id" class="edit-input small">
          <span *ngIf="!editState[machine.id]">{{ machine.cpu }}</span>
        </td>
        <td>
          <input *ngIf="editState[machine.id]" type="number" min="1" [(ngModel)]="machine.memory" [name]="'m-'+machine.id" class="edit-input small">
          <span *ngIf="!editState[machine.id]">{{ machine.memory }} MB</span>
        </td>
        <td>
          <input *ngIf="editState[machine.id]" type="number" min="1" [(ngModel)]="machine.disk" [name]="'d-'+machine.id" class="edit-input small">
          <span *ngIf="!editState[machine.id]">{{ machine.disk }} GB</span>
        </td>

        <!-- Status -->
        <td>
          <span class="status-badge" [ngClass]="machine.machineStatus.toLowerCase()">
            {{ machine.machineStatus }}
          </span>
        </td>

        <!-- Coluna: Hardware -->
        <td class="actions-cell">
          <ng-container *ngIf="!editState[machine.id]">
            <button (click)="toggleEdit(machine.id, true)" class="btn-icon">‚úèÔ∏è</button>
            <button (click)="onDelete(machine.id)" class="btn-icon delete">üóëÔ∏è</button>
          </ng-container>
          <ng-container *ngIf="editState[machine.id]">
            <button (click)="onSave(machine)" class="btn-save">Salvar</button>
            <button (click)="toggleEdit(machine.id, false)" class="btn-cancel">X</button>
          </ng-container>
        </td>

        <!-- Coluna: Opera√ß√£o (A√ß√µes de Status) -->
        <td class="operation-cell">
          <button (click)="onStatusChange(machine.id, 'START')" 
                  [disabled]="machine.machineStatus === 'START' || editState[machine.id]"
                  class="op-btn start" title="Iniciar">‚ñ∂</button>
          
          <button (click)="onStatusChange(machine.id, 'STOP')" 
                  [disabled]="machine.machineStatus === 'STOP' || editState[machine.id]"
                  class="op-btn stop" title="Parar">‚ñ†</button>
          
          <button (click)="onStatusChange(machine.id, 'SUSPEND')" 
                  [disabled]="machine.machineStatus === 'SUSPEND' || editState[machine.id]"
                  class="op-btn suspend" title="Suspender">‚è∏</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>